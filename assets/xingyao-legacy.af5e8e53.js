System.register(["./index-legacy.59b70af2.js"],(function(e,t){"use strict";var n,o,i,r,a,l,s,d,p,m,c,g,u,h,f,b,w,x,y,k,v,S,D,L=document.createElement("style");return L.innerHTML="html,body{margin:0;padding:0}body::-webkit-scrollbar{display:none}p{margin:0}[v-cloak]{display:none}#m-app{height:100%;width:100%;text-align:center;padding:10px 50px 80px;box-sizing:border-box}.m-p-action{margin:20px auto;max-width:1100px;width:100%;font-size:35px;text-align:center;font-weight:700}.m-p-other,.m-p-tamper,.m-p-github,.m-p-language,.m-p-mse{position:fixed;right:50px;background-color:#eff3f6;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%);color:#24292e;border:1px solid rgba(27,31,35,.2);border-radius:3px;cursor:pointer;display:inline-block;font-size:14px;font-weight:600;line-height:20px;padding:6px 12px;z-index:99}.m-p-help{position:fixed;right:50px;top:50px;width:30px;height:30px;color:#666;z-index:2;line-height:30px;font-weight:bolder;border-radius:50%;border:1px solid rgba(27,31,35,.2);cursor:pointer;background-color:#eff3f6;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%)}.m-p-github:hover,.m-p-other:hover,.m-p-tamper:hover,.m-p-help:hover,.m-p-language:hover,.m-p-mse:hover{opacity:.9}.m-p-language{bottom:70px}.m-p-other{bottom:150px}.m-p-tamper{bottom:30px}.m-p-github{bottom:190px}.m-p-mse{bottom:110px}.m-p-refer{position:absolute;left:50px;bottom:50px}.m-p-refer .text{position:absolute;top:-80px;left:-40px;animation-name:upAnimation;transform-origin:center bottom;animation-duration:2s;animation-fill-mode:both;animation-iteration-count:infinite;animation-delay:.5s}.m-p-refer .close{display:block;position:absolute;top:-110px;right:-50px;padding:0;margin:0;width:50px;height:50px;border-radius:50%;border:none;cursor:pointer;z-index:3;transition:.3s all;background-size:30px 30px;background-repeat:no-repeat;background-position:center center;background-image:url(https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/close.png);background-color:rgba(0,0,0,.5)}.m-p-refer .close:hover{background-color:rgba(0,0,0,.8)}.m-p-refer .link{border-radius:4px;text-decoration:none;background-color:#4e84e6;transition:.3s all}.m-p-refer .link:hover{top:-10px;color:#333;border:1px solid transparent;background:rgba(0,0,0,.6);box-shadow:2px 11px 20px rgba(0,0,0,.6)}@keyframes upAnimation{0%{transform:rotate(0);transition-timing-function:cubic-bezier(.215,.61,.355,1)}10%{transform:rotate(-12deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}20%{transform:rotate(12deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}28%{transform:rotate(-10deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}36%{transform:rotate(10deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}42%{transform:rotate(-8deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}48%{transform:rotate(8deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}52%{transform:rotate(-4deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}56%{transform:rotate(4deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}60%{transform:rotate(0);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}to{transform:rotate(0);transition-timing-function:cubic-bezier(.215,.61,.355,1)}}.m-p-temp-url{padding-top:50px;padding-bottom:10px;width:100%;color:#999;text-align:left;font-style:italic;word-break:break-all}.m-p-input-container{display:flex}.m-p-input-container input{flex:1;margin-bottom:20px;display:block;width:280px;padding:16px;font-size:24px;border-radius:4px;box-shadow:none;color:#444;border:1px solid #cccccc}.m-p-input-container .range-input{margin-left:10px;flex:0 0 100px;width:100px;box-sizing:border-box}.m-p-input-container div{position:relative;display:inline-block;margin-left:10px;height:60px;line-height:60px;font-size:24px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all;width:200px}.m-p-input-container div:hover{opacity:.9}.m-p-input-container .disable{cursor:not-allowed;background-color:#ddd}.m-p-line{margin:20px 0 50px;vertical-align:top;width:100%;height:5px;border-bottom:dotted}.m-p-tips{width:100%;color:#999;text-align:left;font-style:italic;word-break:break-all}.m-p-tips p{width:100px;display:inline-block}.m-p-tips.error-tips{color:#dc5350}.m-p-segment{text-align:left}.m-p-segment .item{display:inline-block;margin:10px 6px;width:50px;height:40px;color:#fff;line-height:40px;text-align:center;border-radius:4px;cursor:help;border:solid 1px #eeeeee;background-color:#ddd;transition:.3s all}.m-p-segment .finish{background-color:#0acd76}.m-p-segment .error{cursor:pointer;background-color:#dc5350}.m-p-segment .error:hover{opacity:.9}.m-p-stream,.m-p-report,.m-p-cross,.m-p-final{margin-top:10px;display:inline-block;width:100%;height:50px;line-height:50px;font-size:20px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all}.m-p-stream{background-color:#0acd76!important}.m-p-report{background-color:#e74c3c!important;text-decoration:none}.m-p-final{text-decoration:none}.m-p-force,.m-p-retry{position:absolute;right:50px;display:inline-block;padding:6px 12px;font-size:18px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all}.m-p-retry{right:250px}.m-p-force:hover,.m-p-retry:hover{opacity:.9}\n",document.head.appendChild(L),{setters:[e=>{n=e.d,o=e.ao,i=e.bX,r=e.o,a=e.as,l=e.b$,s=e.A,d=e.a,p=e.b,m=e.t,c=e.aU,g=e.Z,u=e.p,h=e.c0,f=e.F,b=e.P,w=e.v,x=e.c1,y=e.b2,k=e.ah,v=e.i,S=e.c2,D=e.h}],execute:function(){const t={class:"p-8"},L=p("div",{id:"m-loading"},[v(" 页面加载中，请耐心等待... "),p("h1",{style:{"white-space":"pre"}},[v(" 推荐一个 m3u8 网页版提取工具，无需下载软件，打开网站即可下载，自动检测，一键下载。 工具链接：https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html 工具教程：https://segmentfault.com/a/1190000021847172?_ea=32289224 "),p("img",{src:"https://upyun.luckly-mjw.cn/Assets/blog/m3u8-downloader-121-75.jpeg",alt:"m3u8 视频下载工具",title:"logo"}),p("a",{target:"_blank",href:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html"},"点击跳转")])],-1),C={id:"m-app"},M={class:"m-p-action g-box"},U=x('<a class="m-p-help" target="_blank" href="https://segmentfault.com/a/1190000021847172">?</a><a class="m-p-mse" target="_blank" href="https://segmentfault.com/a/1190000025182822">无差别提取工具</a><a class="m-p-tamper" target="_blank" href="https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/m3u8-downloader.user.js">手动添加/更新油猴插件</a><a class="m-p-github" target="_blank" href="https://github.com/Momo707577045/m3u8-downloader">github</a><a class="m-p-other" target="_blank" href="http://blog.luckly-mjw.cn/tool-show/index.html">其他实用工具</a><a class="m-p-language" href="http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index-en.html">English version</a>',6),z={key:0,class:"m-p-refer",target:"_blank",href:"https://segmentfault.com/a/1190000024416860"},I=p("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/001.png",class:"link"},null,-1),_=p("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/003.png",class:"text"},null,-1),j={class:"m-p-input-container"},P=["disabled"],T=["disabled"],E=["disabled"],F={key:2,class:"disable"},N={key:3,class:"m-p-report",target:"_blank",href:"https://segmentfault.com/a/1190000021847172"},Y=p("a",{class:"m-p-final",target:"_blank",href:"https://segmentfault.com/a/1190000025182822"},"下载的视频看不了？试试这个终结解决方案「无差别视频提取工具」，有配套「油猴」插件啦！！！",-1),R=p("div",{class:"m-p-line"},null,-1),O={class:"m-p-tips"},A={class:"m-p-segment"},W=["title","onClick"];e("default",n({__name:"xingyao",setup(e){const n=o({copyUrl:"http://1257120875.vod2.myqcloud.com/0ef121cdvodtransgzp1257120875/3055695e5285890780828799271/v.f230.m3u8",url:"",tips:"m3u8 视频在线提取工具",title:"",isPause:!1,isGetMP4:!1,durationSecond:0,isShowRefer:!1,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],isSupperStreamWrite:!1,streamWriter:null,streamDownloadIndex:0,rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(e){return(new TextEncoder).encode(e)}}}),x=i().copy,v=()=>{x(n.copyUrl),y.success("复制成功")};r((()=>{var e;document.getElementById("m-loading")&&(null===(e=document.getElementById("m-loading"))||void 0===e||e.remove()),B(),setInterval(oe.bind(this),2e3)})),a((()=>{}));const B=()=>{let e=location.href;e.indexOf("?source=")>-1&&(n.url.value=e.split("?source=")[1])},G=()=>{let e=document.title;try{var t;e=(null===(t=window.top)||void 0===t?void 0:t.document.title)||""}catch(n){}return e},$=l().enter;s($,(e=>{e&&K()}));const X=e=>{e=e||{};let t=new XMLHttpRequest;"file"===e.type&&(t.responseType="arraybuffer"),t.onreadystatechange=function(){if(4===t.readyState){let n=t.status;n>=200&&n<300?e.success&&e.success(t.response):e.fail&&e.fail(n)}},t.open("GET",e.url,!0),t.send(null)},H=(e,t)=>{if(t=t||location.href,0===e.indexOf("http"))return 0===location.href.indexOf("https")?e.replace("http://","https://"):e;if("/"===e[0]){let n=t.split("/");return n[0]+"//"+n[2]+e}{let n=t.split("/");return n.pop(),n.join("/")+"/"+e}},V=e=>{n.isGetMP4=e,n.title=new URL(n.url).searchParams.get("title")||n.title;let t=n.title||re(new Date,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(t=G()),n.streamWriter=window.streamSaver.createWriteStream(`${t}.${e?"mp4":"ts"}`).getWriter(),K()},q=()=>{n.isGetMP4=!0,K()},K=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.url?-1!==n.url.toLowerCase().indexOf("m3u8")?n.downloading?alert("资源下载中，请稍后"):location.href.indexOf("blog.luckly-mjw.cn")>-1&&-1===n.url.indexOf(location.protocol)?location.href=`${n.url.split(":")[0]}://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=${n.url}`:(location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"",`${location.href.split("?")[0]}?source=${n.url}`),n.title=new URL(n.url).searchParams.get("title")||n.title,n.tips="m3u8 文件下载中，请稍后",n.beginTime=new Date,X({url:n.url,success:t=>{if(n.tsUrlList=[],n.finishList=[],t.split("\n").forEach((e=>{/^[^#]/.test(e)&&(n.tsUrlList.push(H(e,n.url)),n.finishList.push({title:e,status:""}))})),e)return n.rangeDownload.isShowRange=!0,n.rangeDownload.endSegment=n.tsUrlList.length,void(n.rangeDownload.targetSegment=n.tsUrlList.length);{let e=Math.max(n.rangeDownload.startSegment||1,1),t=Math.max(n.rangeDownload.endSegment||n.tsUrlList.length,1);e=Math.min(e,n.tsUrlList.length),t=Math.min(t,n.tsUrlList.length),n.rangeDownload.startSegment=Math.min(e,t),n.rangeDownload.endSegment=Math.max(e,t),n.rangeDownload.targetSegment=n.rangeDownload.endSegment-n.rangeDownload.startSegment+1,n.downloadIndex=n.rangeDownload.startSegment-1,n.downloading=!0}if(n.isGetMP4){let e=0;t.split("\n").forEach((t=>{t.toUpperCase().indexOf("#EXTINF:")>-1&&(e++,n.rangeDownload.startSegment<=e&&e<=n.rangeDownload.endSegment&&(n.durationSecond+=parseFloat(t.split("#EXTINF:")[1])))}))}t.indexOf("#EXT-X-KEY")>-1?(n.aesConf.method=(t.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],n.aesConf.uri=(t.match(/(.*URI="([^"]+))"/)||["","",""])[2],n.aesConf.iv=(t.match(/(.*IV=([^,\s]+))/)||["","",""])[2],n.aesConf.iv=n.aesConf.iv?n.aesConf.stringToBuffer(n.aesConf.iv):"",n.aesConf.uri=H(n.aesConf.uri,n.url),Z()):n.tsUrlList.length>0?Q():le("资源为空，请查看链接是否有效")},fail:()=>{le("链接不正确，请查看链接是否有效")}})):alert("链接有误，请重新输入"):alert("请输入链接")},Z=()=>{X({type:"file",url:n.aesConf.uri,success:e=>{n.aesConf.key=n.aesConf.stringToBuffer(e),n.aesConf.key=e,n.aesConf.decryptor=k.AES,n.aesConf.decryptor.constructor(),n.aesConf.decryptor.expandKey(n.aesConf.key),Q()},fail:()=>{le("视频已加密，可试用右下角入口的「无差别提取工具」")}})},J=(e,t)=>{let n=e.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t]);return e.aesConf.decryptor.decrypt(e,0,n.buffer||n,!0)},Q=()=>{n.tips="ts 视频碎片下载中，请稍后";let e=()=>{let t=n.isPause,o=n.downloadIndex;o>=n.rangeDownload.endSegment||(n.downloadIndex++,n.finishList[o]&&""===n.finishList[o].status?(n.finishList[o].status="downloading",X({url:n.tsUrlList[o],type:"file",success:i=>{ee(i,o,(()=>n.downloadIndex<n.rangeDownload.endSegment&&!t&&e()))},fail:()=>{n.errorNum++,n.finishList[o].status="error",n.downloadIndex<n.rangeDownload.endSegment&&!t&&e()}})):n.downloadIndex<n.rangeDownload.endSegment&&!t&&e())};for(let t=0;t<Math.min(6,n.rangeDownload.targetSegment-n.finishNum);t++)e()},ee=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=n.aesConf.uri?J(e,t):e;te(i,t,(e=>{if(n.mediaFileList[t-n.rangeDownload.startSegment+1]=e,n.finishList[t].status="finish",n.finishNum++,n.streamWriter){for(let e=n.streamDownloadIndex;e<n.mediaFileList.length&&n.mediaFileList[e];e++)n.streamWriter.write(new Uint8Array(n.mediaFileList[e])),n.mediaFileList[e]=null,n.streamDownloadIndex=e+1;n.streamDownloadIndex>=n.rangeDownload.targetSegment&&n.streamWriter.close()}else if(n.finishNum===n.rangeDownload.targetSegment){let e=n.title||re(n.beginTime,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(e=G()),ie(n.mediaFileList,e)}o&&o()}))},te=(e,t,n)=>{if(e.isGetMP4){let o=new S.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(e.durationSecond)});o.on("data",(o=>{if(t===e.rangeDownload.startSegment-1){let e=new Uint8Array(o.initSegment.byteLength+o.data.byteLength);e.set(o.initSegment,0),e.set(o.data,o.initSegment.byteLength),n(e.buffer)}else n(o.data)})),o.push(new Uint8Array(e)),o.flush()}else n(e)},ne=()=>{n.isPause=!n.isPause,!n.isPause&&n.retryAll(!0)},oe=e=>{if(!n.finishList.length||n.isPause)return;let t=n.downloadIndex;n.finishList.forEach(((e,n)=>{"error"===e.status&&(e.status="",t=Math.min(t,n))})),n.errorNum=0,n.downloadIndex>=n.rangeDownload.endSegment||e?(n.downloadIndex=t,Q()):n.downloadIndex=t},ie=(e,t)=>{n.tips="ts 碎片整合中，请留意浏览器下载";let o=null,i=document.createElement("a");n.isGetMP4?(o=new Blob(e,{type:"video/mp4"}),i.download=t+".mp4"):(o=new Blob(e,{type:"video/MP2T"}),i.download=t+".ts"),i.href=URL.createObjectURL(o),i.style.display="none",document.body.appendChild(i),i.click(),i.remove()},re=(e,t)=>{const n={Y:e.getFullYear(),M:e.getMonth()+1,D:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};return t.replace(/Y+|M+|D+|h+|m+|s+/g,(e=>(new Array(e.length).join("0")+n[e[0]]).substr(-e.length)))},ae=()=>{if(n.mediaFileList.length){let e=n.title||re(n.beginTime,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(e=G()),ie(n.mediaFileList,e)}else alert("当前无已下载片段")},le=e=>{alert(e),n.downloading=!1,n.tips="m3u8 视频在线提取工具"},se=()=>{window.open("http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html")};return(e,o)=>(D(),d("div",t,[L,p("section",C,[p("section",M,m(n.tips),1),U,n.isShowRefer?(D(),d("a",z,[I,_,p("i",{class:"close",onClick:o[0]||(o[0]=c((e=>n.isShowRefer=!1),["prevent"]))})])):g("",!0),p("div",{class:"m-p-temp-url",onDblclick:v}," 测试链接(双击复制)："+m(n.copyUrl),33),p("section",j,[u(p("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>n.url=e),type:"text",disabled:n.downloading,placeholder:"请输入 m3u8 链接"},null,8,P),[[h,n.url]]),!n.downloading||n.rangeDownload.isShowRange?(D(),d(f,{key:0},[n.rangeDownload.isShowRange?(D(),d(f,{key:1},[u(p("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>n.rangeDownload.startSegment=e),class:"range-input",type:"number",disabled:n.downloading,placeholder:"起始片段"},null,8,T),[[h,n.rangeDownload.startSegment]]),u(p("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>n.rangeDownload.endSegment=e),class:"range-input",type:"number",disabled:n.downloading,placeholder:"截止片段"},null,8,E),[[h,n.rangeDownload.endSegment]])],64)):(D(),d("div",{key:0,onClick:o[2]||(o[2]=e=>K(!0))}," 特定范围下载 "))],64)):g("",!0),n.downloading?n.finishNum===n.rangeDownload.targetSegment&&n.rangeDownload.targetSegment>0?(D(),d("div",F," 下载完成 ")):(D(),d("div",{key:3,onClick:ne},m(n.isPause?"恢复下载":"暂停下载"),1)):(D(),d(f,{key:1},[p("div",{onClick:o[5]||(o[5]=e=>K(!1))},"原格式下载"),p("div",{onClick:q},"转码为MP4下载")],64))]),!n.downloading&&n.isSupperStreamWrite?(D(),d("div",{key:1,class:"m-p-stream",onClick:o[6]||(o[6]=e=>V(!1))}," 特大视频原格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):g("",!0),!n.downloading&&n.isSupperStreamWrite?(D(),d("div",{key:2,class:"m-p-stream",onClick:o[7]||(o[7]=e=>V(!0))}," 特大视频 MP4 格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):g("",!0),n.downloading?g("",!0):(D(),d("a",N,"运行出现问题，可点击此按钮留言反馈，作者将第一时间跟进，共同维护本项目")),p("div",{class:"m-p-cross",onClick:se}," 当无法下载，点击跳转到原页面查看解决办法 "),Y,n.finishList.length>0?(D(),d(f,{key:4},[R,n.errorNum&&n.downloadIndex>=n.rangeDownload.targetSegment?(D(),d("div",{key:0,class:"m-p-retry",onClick:oe}," 重新下载错误片段 ")):g("",!0),n.mediaFileList.length&&!n.streamWriter?(D(),d("div",{key:1,class:"m-p-force",onClick:ae}," 强制下载现有片段 ")):g("",!0),p("div",O," 待下载碎片总量："+m(n.rangeDownload.targetSegment)+"，已下载："+m(n.finishNum)+"，错误："+m(n.errorNum)+"，进度："+m((n.finishNum/n.rangeDownload.targetSegment*100).toFixed(2))+"% ",1),p("div",{class:b(["m-p-tips",[n.errorNum?"error-tips":""]])}," 若某视频碎片下载发生错误，将标记为红色，可点击相应图标进行重试 ",2),p("section",A,[(D(!0),d(f,null,w(n.finishList,((e,t)=>(D(),d("div",{key:e,class:b(["item",[e.status]]),title:e.title,onClick:e=>(e=>{"error"===n.finishList[e].status&&(n.finishList[e].status="",X({url:n.tsUrlList[e],type:"file",success:t=>{n.errorNum--,ee(t,e)},fail:()=>{n.finishList[e].status="error"}}))})(t)},m(t+1),11,W)))),128))])],64)):g("",!0)])]))}}))}}}));
