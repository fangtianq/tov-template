System.register(["./index-legacy.7a69c0b7.js"],(function(e,t){"use strict";var n,o,i,r,a,l,s,d,p,m,c,g,u,h,f,b,w,x,y,k,v,S,D,L;return{setters:[e=>{n=e.d,o=e.g,i=e.aj,r=e.h,a=e.Z,l=e.al,s=e.Y,d=e.Q,p=e.o,m=e.a,c=e.b,g=e.B,u=e.y,h=e.am,f=e.E,b=e.O,w=e.an,x=e.F,y=e.n,k=e.D,v=e.A,S=e.ao,D=e.a3,L=e.ap}],execute:function(){var t=document.createElement("style");t.textContent="html,body{margin:0;padding:0}body::-webkit-scrollbar{display:none}p{margin:0}[v-cloak]{display:none}#m-app{height:100%;width:100%;text-align:center;padding:10px 50px 80px;box-sizing:border-box}.m-p-action{margin:20px auto;max-width:1100px;width:100%;font-size:35px;text-align:center;font-weight:700}.m-p-other,.m-p-tamper,.m-p-github,.m-p-language,.m-p-mse{position:fixed;right:50px;background-color:#eff3f6;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%);color:#24292e;border:1px solid rgba(27,31,35,.2);border-radius:3px;cursor:pointer;display:inline-block;font-size:14px;font-weight:600;line-height:20px;padding:6px 12px;z-index:99}.m-p-help{position:fixed;right:50px;top:50px;width:30px;height:30px;color:#666;z-index:2;line-height:30px;font-weight:bolder;border-radius:50%;border:1px solid rgba(27,31,35,.2);cursor:pointer;background-color:#eff3f6;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%)}.m-p-github:hover,.m-p-other:hover,.m-p-tamper:hover,.m-p-help:hover,.m-p-language:hover,.m-p-mse:hover{opacity:.9}.m-p-language{bottom:70px}.m-p-other{bottom:150px}.m-p-tamper{bottom:30px}.m-p-github{bottom:190px}.m-p-mse{bottom:110px}.m-p-refer{position:absolute;left:50px;bottom:50px}.m-p-refer .text{position:absolute;top:-80px;left:-40px;animation-name:upAnimation;transform-origin:center bottom;animation-duration:2s;animation-fill-mode:both;animation-iteration-count:infinite;animation-delay:.5s}.m-p-refer .close{display:block;position:absolute;top:-110px;right:-50px;padding:0;margin:0;width:50px;height:50px;border-radius:50%;border:none;cursor:pointer;z-index:3;transition:.3s all;background-size:30px 30px;background-repeat:no-repeat;background-position:center center;background-image:url(https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/close.png);background-color:rgba(0,0,0,.5)}.m-p-refer .close:hover{background-color:rgba(0,0,0,.8)}.m-p-refer .link{border-radius:4px;text-decoration:none;background-color:#4e84e6;transition:.3s all}.m-p-refer .link:hover{top:-10px;color:#333;border:1px solid transparent;background:rgba(0,0,0,.6);box-shadow:2px 11px 20px rgba(0,0,0,.6)}@keyframes upAnimation{0%{transform:rotate(0);transition-timing-function:cubic-bezier(.215,.61,.355,1)}10%{transform:rotate(-12deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}20%{transform:rotate(12deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}28%{transform:rotate(-10deg);transition-timing-function:cubic-bezier(.215,.61,.355,1)}36%{transform:rotate(10deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}42%{transform:rotate(-8deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}48%{transform:rotate(8deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}52%{transform:rotate(-4deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}56%{transform:rotate(4deg);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}60%{transform:rotate(0);transition-timing-function:cubic-bezier(.755,.5,.855,.06)}to{transform:rotate(0);transition-timing-function:cubic-bezier(.215,.61,.355,1)}}.m-p-temp-url{padding-top:50px;padding-bottom:10px;width:100%;color:#999;text-align:left;font-style:italic;word-break:break-all}.m-p-input-container{display:flex}.m-p-input-container input{flex:1;margin-bottom:20px;display:block;width:280px;padding:16px;font-size:24px;border-radius:4px;box-shadow:none;color:#444;border:1px solid #cccccc}.m-p-input-container .range-input{margin-left:10px;flex:0 0 100px;width:100px;box-sizing:border-box}.m-p-input-container div{position:relative;display:inline-block;margin-left:10px;height:60px;line-height:60px;font-size:24px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all;width:200px}.m-p-input-container div:hover{opacity:.9}.m-p-input-container .disable{cursor:not-allowed;background-color:#ddd}.m-p-line{margin:20px 0 50px;vertical-align:top;width:100%;height:5px;border-bottom:dotted}.m-p-tips{width:100%;color:#999;text-align:left;font-style:italic;word-break:break-all}.m-p-tips p{width:100px;display:inline-block}.m-p-tips.error-tips{color:#dc5350}.m-p-segment{text-align:left}.m-p-segment .item{display:inline-block;margin:10px 6px;width:50px;height:40px;color:#fff;line-height:40px;text-align:center;border-radius:4px;cursor:help;border:solid 1px #eeeeee;background-color:#ddd;transition:.3s all}.m-p-segment .finish{background-color:#0acd76}.m-p-segment .error{cursor:pointer;background-color:#dc5350}.m-p-segment .error:hover{opacity:.9}.m-p-stream,.m-p-report,.m-p-cross,.m-p-final{margin-top:10px;display:inline-block;width:100%;height:50px;line-height:50px;font-size:20px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all}.m-p-stream{background-color:#0acd76!important}.m-p-report{background-color:#e74c3c!important;text-decoration:none}.m-p-final{text-decoration:none}.m-p-force,.m-p-retry{position:absolute;right:50px;display:inline-block;padding:6px 12px;font-size:18px;color:#fff;cursor:pointer;border-radius:4px;border:1px solid #eeeeee;background-color:#3d8ac7;opacity:1;transition:.3s all}.m-p-retry{right:250px}.m-p-force:hover,.m-p-retry:hover{opacity:.9}\n",document.head.appendChild(t);var C={class:"p-8"},M=c("div",{id:"m-loading"},[v(" 页面加载中，请耐心等待... "),c("h1",{style:{"white-space":"pre"}},[v(" 推荐一个 m3u8 网页版提取工具，无需下载软件，打开网站即可下载，自动检测，一键下载。 工具链接：https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html 工具教程：https://segmentfault.com/a/1190000021847172?_ea=32289224 "),c("img",{src:"https://upyun.luckly-mjw.cn/Assets/blog/m3u8-downloader-121-75.jpeg",alt:"m3u8 视频下载工具",title:"logo"}),c("a",{target:"_blank",href:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html"},"点击跳转")])],-1),U={id:"m-app"},z={class:"m-p-action g-box"},I=S('<a class="m-p-help" target="_blank" href="https://segmentfault.com/a/1190000021847172">?</a><a class="m-p-mse" target="_blank" href="https://segmentfault.com/a/1190000025182822">无差别提取工具</a><a class="m-p-tamper" target="_blank" href="https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/m3u8-downloader.user.js">手动添加/更新油猴插件</a><a class="m-p-github" target="_blank" href="https://github.com/Momo707577045/m3u8-downloader">github</a><a class="m-p-other" target="_blank" href="http://blog.luckly-mjw.cn/tool-show/index.html">其他实用工具</a><a class="m-p-language" href="http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index-en.html">English version</a>',6),_={key:0,class:"m-p-refer",target:"_blank",href:"https://segmentfault.com/a/1190000024416860"},j=c("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/001.png",class:"link"},null,-1),P=c("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/003.png",class:"text"},null,-1),E={class:"m-p-input-container"},T=["disabled"],Y=["disabled"],F=["disabled"],N={key:2,class:"disable"},O={key:3,class:"m-p-report",target:"_blank",href:"https://segmentfault.com/a/1190000021847172"},R=c("a",{class:"m-p-final",target:"_blank",href:"https://segmentfault.com/a/1190000025182822"},"下载的视频看不了？试试这个终结解决方案「无差别视频提取工具」，有配套「油猴」插件啦！！！",-1),A=c("div",{class:"m-p-line"},null,-1),W={class:"m-p-tips"},B={class:"m-p-segment"},G=["title","onClick"];e("default",n({__name:"xingyao",setup(e){var t=o({copyUrl:"http://1257120875.vod2.myqcloud.com/0ef121cdvodtransgzp1257120875/3055695e5285890780828799271/v.f230.m3u8",url:"",tips:"m3u8 视频在线提取工具",title:"",isPause:!1,isGetMP4:!1,durationSecond:0,isShowRefer:!1,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],isSupperStreamWrite:!1,streamWriter:null,streamDownloadIndex:0,rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(e){return(new TextEncoder).encode(e)}}}),n=i().copy,v=()=>{n(t.copyUrl),D.success("复制成功")};r((()=>{var e;document.getElementById("m-loading")&&(null===(e=document.getElementById("m-loading"))||void 0===e||e.remove()),S(),setInterval(oe.bind(this),2e3)})),a((()=>{}));var S=()=>{var e=location.href;e.indexOf("?source=")>-1&&(t.url.value=e.split("?source=")[1])},$=()=>{var e=document.title;try{var t;e=(null===(t=window.top)||void 0===t?void 0:t.document.title)||""}catch(n){}return e},X=l().enter;s(X,(e=>{e&&Q()}));var V=e=>{e=e||{};var t=new XMLHttpRequest;"file"===e.type&&(t.responseType="arraybuffer"),t.onreadystatechange=function(){if(4===t.readyState){var n=t.status;n>=200&&n<300?e.success&&e.success(t.response):e.fail&&e.fail(n)}},t.open("GET",e.url,!0),t.send(null)},H=(e,t)=>{if(t=t||location.href,0===e.indexOf("http"))return 0===location.href.indexOf("https")?e.replace("http://","https://"):e;if("/"===e[0]){var n=t.split("/");return n[0]+"//"+n[2]+e}var o=t.split("/");return o.pop(),o.join("/")+"/"+e},q=e=>{t.isGetMP4=e,t.title=new URL(t.url).searchParams.get("title")||t.title;var n=t.title||re(new Date,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(n=$()),t.streamWriter=window.streamSaver.createWriteStream(`${n}.${e?"mp4":"ts"}`).getWriter(),Q()},K=()=>{t.isGetMP4=!0,Q()},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.url?-1!==t.url.toLowerCase().indexOf("m3u8")?t.downloading?alert("资源下载中，请稍后"):location.href.indexOf("blog.luckly-mjw.cn")>-1&&-1===t.url.indexOf(location.protocol)?location.href=`${t.url.split(":")[0]}://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=${t.url}`:(location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"",`${location.href.split("?")[0]}?source=${t.url}`),t.title=new URL(t.url).searchParams.get("title")||t.title,t.tips="m3u8 文件下载中，请稍后",t.beginTime=new Date,V({url:t.url,success:n=>{if(t.tsUrlList=[],t.finishList=[],n.split("\n").forEach((e=>{/^[^#]/.test(e)&&(t.tsUrlList.push(H(e,t.url)),t.finishList.push({title:e,status:""}))})),e)return t.rangeDownload.isShowRange=!0,t.rangeDownload.endSegment=t.tsUrlList.length,void(t.rangeDownload.targetSegment=t.tsUrlList.length);var o=Math.max(t.rangeDownload.startSegment||1,1),i=Math.max(t.rangeDownload.endSegment||t.tsUrlList.length,1);if(o=Math.min(o,t.tsUrlList.length),i=Math.min(i,t.tsUrlList.length),t.rangeDownload.startSegment=Math.min(o,i),t.rangeDownload.endSegment=Math.max(o,i),t.rangeDownload.targetSegment=t.rangeDownload.endSegment-t.rangeDownload.startSegment+1,t.downloadIndex=t.rangeDownload.startSegment-1,t.downloading=!0,t.isGetMP4){var r=0;n.split("\n").forEach((e=>{e.toUpperCase().indexOf("#EXTINF:")>-1&&(r++,t.rangeDownload.startSegment<=r&&r<=t.rangeDownload.endSegment&&(t.durationSecond+=parseFloat(e.split("#EXTINF:")[1])))}))}n.indexOf("#EXT-X-KEY")>-1?(t.aesConf.method=(n.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],t.aesConf.uri=(n.match(/(.*URI="([^"]+))"/)||["","",""])[2],t.aesConf.iv=(n.match(/(.*IV=([^,\s]+))/)||["","",""])[2],t.aesConf.iv=t.aesConf.iv?t.aesConf.stringToBuffer(t.aesConf.iv):"",t.aesConf.uri=H(t.aesConf.uri,t.url),Z()):t.tsUrlList.length>0?J():le("资源为空，请查看链接是否有效")},fail:()=>{le("链接不正确，请查看链接是否有效")}})):alert("链接有误，请重新输入"):alert("请输入链接")},Z=()=>{V({type:"file",url:t.aesConf.uri,success:e=>{t.aesConf.key=t.aesConf.stringToBuffer(e),t.aesConf.key=e,t.aesConf.decryptor=d.AES,t.aesConf.decryptor.constructor(),t.aesConf.decryptor.expandKey(t.aesConf.key),J()},fail:()=>{le("视频已加密，可试用右下角入口的「无差别提取工具」")}})},J=()=>{t.tips="ts 视频碎片下载中，请稍后";for(var e=()=>{var n=t.isPause,o=t.downloadIndex;o>=t.rangeDownload.endSegment||(t.downloadIndex++,t.finishList[o]&&""===t.finishList[o].status?(t.finishList[o].status="downloading",V({url:t.tsUrlList[o],type:"file",success:i=>{ee(i,o,(()=>t.downloadIndex<t.rangeDownload.endSegment&&!n&&e()))},fail:()=>{t.errorNum++,t.finishList[o].status="error",t.downloadIndex<t.rangeDownload.endSegment&&!n&&e()}})):t.downloadIndex<t.rangeDownload.endSegment&&!n&&e())},n=0;n<Math.min(6,t.rangeDownload.targetSegment-t.finishNum);n++)e()},ee=function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},i=t.aesConf.uri?((e,t)=>{var n=e.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t]);return e.aesConf.decryptor.decrypt(e,0,n.buffer||n,!0)})(e,n):e;te(i,n,(e=>{if(t.mediaFileList[n-t.rangeDownload.startSegment+1]=e,t.finishList[n].status="finish",t.finishNum++,t.streamWriter){for(var i=t.streamDownloadIndex;i<t.mediaFileList.length&&t.mediaFileList[i];i++)t.streamWriter.write(new Uint8Array(t.mediaFileList[i])),t.mediaFileList[i]=null,t.streamDownloadIndex=i+1;t.streamDownloadIndex>=t.rangeDownload.targetSegment&&t.streamWriter.close()}else if(t.finishNum===t.rangeDownload.targetSegment){var r=t.title||re(t.beginTime,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(r=$()),ie(t.mediaFileList,r)}o&&o()}))},te=(e,t,n)=>{if(e.isGetMP4){var o=new L.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(e.durationSecond)});o.on("data",(o=>{if(t===e.rangeDownload.startSegment-1){var i=new Uint8Array(o.initSegment.byteLength+o.data.byteLength);i.set(o.initSegment,0),i.set(o.data,o.initSegment.byteLength),n(i.buffer)}else n(o.data)})),o.push(new Uint8Array(e)),o.flush()}else n(e)},ne=()=>{t.isPause=!t.isPause,!t.isPause&&t.retryAll(!0)},oe=e=>{if(t.finishList.length&&!t.isPause){var n=t.downloadIndex;t.finishList.forEach(((e,t)=>{"error"===e.status&&(e.status="",n=Math.min(n,t))})),t.errorNum=0,t.downloadIndex>=t.rangeDownload.endSegment||e?(t.downloadIndex=n,J()):t.downloadIndex=n}},ie=(e,n)=>{t.tips="ts 碎片整合中，请留意浏览器下载";var o=null,i=document.createElement("a");t.isGetMP4?(o=new Blob(e,{type:"video/mp4"}),i.download=n+".mp4"):(o=new Blob(e,{type:"video/MP2T"}),i.download=n+".ts"),i.href=URL.createObjectURL(o),i.style.display="none",document.body.appendChild(i),i.click(),i.remove()},re=(e,t)=>{var n={Y:e.getFullYear(),M:e.getMonth()+1,D:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};return t.replace(/Y+|M+|D+|h+|m+|s+/g,(e=>(new Array(e.length).join("0")+n[e[0]]).substr(-e.length)))},ae=()=>{if(t.mediaFileList.length){var e=t.title||re(t.beginTime,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(e=$()),ie(t.mediaFileList,e)}else alert("当前无已下载片段")},le=e=>{alert(e),t.downloading=!1,t.tips="m3u8 视频在线提取工具"},se=()=>{window.open("http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html")};return(e,n)=>(p(),m("div",C,[M,c("section",U,[c("section",z,g(u(t).tips),1),I,u(t).isShowRefer?(p(),m("a",_,[j,P,c("i",{class:"close",onClick:n[0]||(n[0]=h((e=>u(t).isShowRefer=!1),["prevent"]))})])):f("",!0),c("div",{class:"m-p-temp-url",onDblclick:v}," 测试链接(双击复制)："+g(u(t).copyUrl),33),c("section",E,[b(c("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>u(t).url=e),type:"text",disabled:u(t).downloading,placeholder:"请输入 m3u8 链接"},null,8,T),[[w,u(t).url]]),!u(t).downloading||u(t).rangeDownload.isShowRange?(p(),m(x,{key:0},[u(t).rangeDownload.isShowRange?(p(),m(x,{key:1},[b(c("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>u(t).rangeDownload.startSegment=e),class:"range-input",type:"number",disabled:u(t).downloading,placeholder:"起始片段"},null,8,Y),[[w,u(t).rangeDownload.startSegment]]),b(c("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>u(t).rangeDownload.endSegment=e),class:"range-input",type:"number",disabled:u(t).downloading,placeholder:"截止片段"},null,8,F),[[w,u(t).rangeDownload.endSegment]])],64)):(p(),m("div",{key:0,onClick:n[2]||(n[2]=e=>Q(!0))}," 特定范围下载 "))],64)):f("",!0),u(t).downloading?u(t).finishNum===u(t).rangeDownload.targetSegment&&u(t).rangeDownload.targetSegment>0?(p(),m("div",N," 下载完成 ")):(p(),m("div",{key:3,onClick:ne},g(u(t).isPause?"恢复下载":"暂停下载"),1)):(p(),m(x,{key:1},[c("div",{onClick:n[5]||(n[5]=e=>Q(!1))},"原格式下载"),c("div",{onClick:K},"转码为MP4下载")],64))]),!u(t).downloading&&u(t).isSupperStreamWrite?(p(),m("div",{key:1,class:"m-p-stream",onClick:n[6]||(n[6]=e=>q(!1))}," 特大视频原格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):f("",!0),!u(t).downloading&&u(t).isSupperStreamWrite?(p(),m("div",{key:2,class:"m-p-stream",onClick:n[7]||(n[7]=e=>q(!0))}," 特大视频 MP4 格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):f("",!0),u(t).downloading?f("",!0):(p(),m("a",O,"运行出现问题，可点击此按钮留言反馈，作者将第一时间跟进，共同维护本项目")),c("div",{class:"m-p-cross",onClick:se}," 当无法下载，点击跳转到原页面查看解决办法 "),R,u(t).finishList.length>0?(p(),m(x,{key:4},[A,u(t).errorNum&&u(t).downloadIndex>=u(t).rangeDownload.targetSegment?(p(),m("div",{key:0,class:"m-p-retry",onClick:oe}," 重新下载错误片段 ")):f("",!0),u(t).mediaFileList.length&&!u(t).streamWriter?(p(),m("div",{key:1,class:"m-p-force",onClick:ae}," 强制下载现有片段 ")):f("",!0),c("div",W," 待下载碎片总量："+g(u(t).rangeDownload.targetSegment)+"，已下载："+g(u(t).finishNum)+"，错误："+g(u(t).errorNum)+"，进度："+g((u(t).finishNum/u(t).rangeDownload.targetSegment*100).toFixed(2))+"% ",1),c("div",{class:y(["m-p-tips",[u(t).errorNum?"error-tips":""]])}," 若某视频碎片下载发生错误，将标记为红色，可点击相应图标进行重试 ",2),c("section",B,[(p(!0),m(x,null,k(u(t).finishList,((e,n)=>(p(),m("div",{key:e,class:y(["item",[e.status]]),title:e.title,onClick:e=>(e=>{"error"===t.finishList[e].status&&(t.finishList[e].status="",V({url:t.tsUrlList[e],type:"file",success:n=>{t.errorNum--,ee(n,e)},fail:()=>{t.finishList[e].status="error"}}))})(n)},g(n+1),11,G)))),128))])],64)):f("",!0)])]))}}))}}}));
