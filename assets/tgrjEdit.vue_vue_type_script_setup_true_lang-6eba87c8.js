import{d as M,m as _,a as p,b as w,F as P,s as A,X as C,w as u,j as v,t as L,bu as ae,f as V,af as le,o as se,c5 as ie,ao as G,c3 as x,bs as l,c6 as j,b1 as ue,l as ce,r as m,h as t,Z as re,c7 as S,bt as I,ah as de,aO as $}from"./index-1227f530.js";/* empty css             */import{E as W}from"./tag-1f9369ac.js";import{E as me}from"./button-acf95ccc.js";import{E as pe}from"./index-7affc313.js";const fe=v(" + New Tag "),ye=M({__name:"tags",props:{dynamicTags:{type:Array,default:()=>[]}},setup(R){const q=R,g=_(""),D=_(q.dynamicTags),U=_(!1),h=_(),z=c=>{D.value.splice(D.value.indexOf(c),1)},E=()=>{U.value=!0,le(()=>{h.value.input.focus()})},f=()=>{g.value&&D.value.push(g.value),U.value=!1,g.value=""};return(c,K)=>{const n=W,O=me;return p(),w(P,null,[(p(!0),w(P,null,A(D.value,k=>(p(),C(n,{key:k,class:"mx-1",closable:"","disable-transitions":!1,onClose:r=>z(k)},{default:u(()=>[v(L(k),1)]),_:2},1032,["onClose"]))),128)),U.value?(p(),C(V(pe),{key:0,ref_key:"InputRef",ref:h,modelValue:g.value,"onUpdate:modelValue":K[0]||(K[0]=k=>g.value=k),class:"ml-1 w-20",size:"small",onKeyup:ae(f,["enter"]),onBlur:f},null,8,["modelValue","onKeyup"])):(p(),C(O,{key:1,class:"button-new-tag ml-1",size:"small",onClick:E},{default:u(()=>[fe]),_:1}))],64)}}}),ge={class:"p-4 px-12"},_e=v("新增"),ve=v("我的like"),ke=v("全部"),be=v("提交"),xe=v("重置"),Te=M({__name:"tgrjEdit",setup(R){se(()=>{T()});const q=ie(),g=_(),D=_(),U=_(),h=()=>{},z=o=>{n.content=o.content,n.contentTitle=f[o.type].content,n.dynamicTags.splice(0),n.dynamicTags.push(...o.tags),n.type=o.type,n.objectId=o.objectId,r.add=!0},E=async o=>{if(await S.modal.confirm("您确定要删除该数据?")==="confirm"){const i=U.value;I.Object.createWithoutData(l.FUCKDOG.name,o.objectId).destroy(),i.remove(o),S.modal.message({content:"删除成功。",status:"success"})}},f={fuckDog:{label:l.FUCKDOG.type.fuckDog,content:"甜狗日记"},sunnySaying:{label:l.FUCKDOG.type.sunnySaying,content:"阳光语录"},ikun:{label:l.FUCKDOG.type.ikun,content:"ikun（鸡你太美）"}},c=G({currentPage:1,pageSize:10,totalResult:300}),K=async o=>{const e=o.data,i=de.MD5(e.content).toString();if(!n.objectId){const d=x()(l.FUCKDOG.name);if(d.equalTo(l.FUCKDOG.keys.md5,i),(await d.find()).length!=0){S.modal.message({content:"当前语录已存在",status:"info"});return}}const y=I.Object.extend(l.FUCKDOG.name);let s=new y;n.objectId&&(s=I.Object.createWithoutData(l.FUCKDOG.name,n.objectId)),s.set(l.FUCKDOG.keys.type,e.type),s.set(l.FUCKDOG.keys.tags,n.dynamicTags),s.set(l.FUCKDOG.keys.content,e.content),s.set(l.FUCKDOG.keys.md5,i),s.addUnique(l.FUCKDOG.keys.like,$()().id),s.addUnique(l.FUCKDOG.keys.bookmark,$()().id),s.save().then(d=>{S.modal.message({content:"保存成功。",status:"success"}),g.value.close(),T()})},n=G({objectId:"",type:"fuckDog",dynamicTags:["fuckDog"],content:"",contentTitle:"舔狗日记"}),O=o=>{n.contentTitle=o.$radio.props.content,n.dynamicTags[0]=o.$radio.props.label},k=G({content:[{required:!0,message:"请输入..."},{min:1,max:5e3}]}),r=G({add:!1,filterName:"",tableData:[]}),T=()=>{const o=x()(l.FUCKDOG.name);o.count().then(y=>c.totalResult=y),o.contains("content",r.filterName);const e=x()(l.FUCKDOG.name);e.contains("type",r.filterName);const i=x()(l.FUCKDOG.name);i.contains("tags",r.filterName),j()().or(o,e,i).limit(c.pageSize).skip((c.currentPage-1)*c.pageSize).find().then(y=>{r.tableData=y.map(s=>{const d=s.toJSON();return d.likeNum=d.like.length,d})})},X=ue.debounce(T,1e3),J=_(!0),B=ce(J),Q=()=>{const o=x()(l.FUCKDOG.name);o.equalTo(l.FUCKDOG.keys.like,$()().id),o.count().then(s=>c.totalResult=s),o.contains("content",r.filterName);const e=x()(l.FUCKDOG.name);e.contains("type",r.filterName);const i=x()(l.FUCKDOG.name);i.contains("tags",r.filterName);const y=j()().or(e,i);j()().and(o,y).limit(c.pageSize).skip((c.currentPage-1)*c.pageSize).find().then(s=>{r.tableData=s.map(d=>{const F=d.toJSON();return F.likeNum=F.like.length,F})})};return(o,e)=>{const i=m("vxe-button"),y=m("vxe-input"),s=m("vxe-form-item"),d=m("vxe-radio"),F=ye,Y=m("vxe-textarea"),Z=m("vxe-form"),H=m("vxe-modal"),ee=m("vxe-toolbar"),b=m("vxe-column"),te=W,ne=m("vxe-table"),oe=m("vxe-pager");return p(),w("div",ge,[t(ee,null,{buttons:u(()=>[t(i,{icon:"vxe-icon-square-plus",onClick:e[0]||(e[0]=a=>r.add=!0)},{default:u(()=>[_e]),_:1}),J.value?(p(),C(i,{key:0,icon:"vxe-icon-user-fill",onClick:e[1]||(e[1]=a=>(Q(),V(B)()))},{default:u(()=>[ve]),_:1})):(p(),C(i,{key:1,icon:"vxe-icon-user-fill",onClick:e[2]||(e[2]=a=>(T(),V(B)()))},{default:u(()=>[ke]),_:1})),t(y,{modelValue:r.filterName,"onUpdate:modelValue":e[3]||(e[3]=a=>r.filterName=a),class:"pl-4",placeholder:"试试全表搜索",onKeyup:V(X)},null,8,["modelValue","onKeyup"]),t(H,{ref_key:"xModal",ref:g,modelValue:r.add,"onUpdate:modelValue":e[8]||(e[8]=a=>r.add=a),title:"舔狗日记投稿",width:"1288",height:"888","show-zoom":"",resize:"","mask-closable":""},{default:u(()=>[t(Z,{ref_key:"xForm",ref:D,data:n,rules:k,"title-align":"right","title-width":"60",onSubmit:K,onReset:h},{default:u(()=>[t(s,{title:"欢迎各位舔狗分享自己的心酸历程","title-align":"left","title-width":"300px","title-prefix":{icon:"vxe-icon-question-circle-fill"}}),t(s,{title:"语录类型",field:"name",span:"24","title-colon":"","title-width":"100","item-render":{}},{default:u(()=>[t(d,{modelValue:n.type,"onUpdate:modelValue":e[4]||(e[4]=a=>n.type=a),label:f.fuckDog.label,content:f.fuckDog.content,onChange:O},null,8,["modelValue","label","content"]),t(d,{modelValue:n.type,"onUpdate:modelValue":e[5]||(e[5]=a=>n.type=a),label:f.sunnySaying.label,content:f.sunnySaying.content,onChange:O},null,8,["modelValue","label","content"]),t(d,{modelValue:n.type,"onUpdate:modelValue":e[6]||(e[6]=a=>n.type=a),label:f.ikun.label,content:f.ikun.content,onChange:O},null,8,["modelValue","label","content"])]),_:1}),t(s,{title:"标签",field:"tags",span:"24","title-colon":"","title-width":"100","item-render":{}},{default:u(()=>[t(F,{"dynamic-tags":n.dynamicTags},null,8,["dynamic-tags"])]),_:1}),t(s,{title:n.contentTitle,field:"content",span:"24","title-width":"100","title-colon":"","item-render":{}},{default:u(()=>[t(Y,{modelValue:n.content,"onUpdate:modelValue":e[7]||(e[7]=a=>n.content=a),placeholder:"心路历程",rows:"24"},null,8,["modelValue"])]),_:1},8,["title"]),t(s,{align:"center",span:"24"},{default:u(()=>[t(i,{type:"submit",status:"primary"},{default:u(()=>[be]),_:1}),t(i,{type:"reset"},{default:u(()=>[xe]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1},8,["modelValue"])]),_:1}),t(ne,{ref_key:"xTable",ref:U,data:r.tableData,stripe:""},{default:u(()=>[t(b,{type:"seq",title:"序号",width:"60"}),t(b,{field:"content",title:"内容","show-overflow":""}),t(b,{field:"type",title:"类型"}),t(b,{field:"tags",title:"标签"},{default:u(({row:a})=>[(p(!0),w(P,null,A(a.tags,N=>(p(),C(te,{key:N,class:"mx-1","disable-transitions":!1},{default:u(()=>[v(L(N),1)]),_:2},1024))),128))]),_:1}),t(b,{field:"like","show-overflow":"ellipsis",title:"like"}),t(b,{field:"likeNum",title:"likeNum"}),V(q)?(p(),C(b,{key:0,title:"操作",width:"100","show-overflow":""},{default:u(({row:a})=>[t(i,{type:"text",icon:"vxe-icon-edit",onClick:N=>z(a)},null,8,["onClick"]),t(i,{type:"text",icon:"vxe-icon-delete",onClick:N=>E(a)},null,8,["onClick"])]),_:1})):re("",!0)]),_:1},8,["data"]),t(oe,{"current-page":c.currentPage,"onUpdate:current-page":e[9]||(e[9]=a=>c.currentPage=a),"page-size":c.pageSize,"onUpdate:page-size":e[10]||(e[10]=a=>c.pageSize=a),background:"",total:c.totalResult,layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"],onPageChange:T},null,8,["current-page","page-size","total"])])}}});export{Te as _};
