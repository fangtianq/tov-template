/* empty css             */import{E as I}from"./button-6767a647.js";import{_ as N}from"./delete-1db96267.js";/* empty css              */import{g as h,h as T,av as C,j as w,K as x,l as D,aV as u,o as _,z as m,p as c,F as E,aq as J,s as V,A as v,w as B,a9 as O,c1 as M,c2 as U,b4 as l,b5 as A,aA as F,aa as L}from"./index-c20bf65e.js";import{a as z}from"./request-e802b356.js";import{E as Q}from"./index-967dde3a.js";const R={class:"main p-4"},q={class:"message-container"},P=c("h3",null,"后台：org.sang.socket.livequery.LiveQueryController",-1),$=c("h3",null,"https://github.com/fangtianq/FTQPriSpringbootVueBlog",-1),H={class:"mdui-card-primary"},K={class:"mdui-card-content message-content inline-block"},W={class:"inline-block"},Y=h({__name:"liveQuery",setup(G){const j=T(C.REFDANMU);let o,r;const i={Authorization:"",ContentType:"text/LCObject"};let d=null;const y=(e,t)=>{o.send("/app/updateObject",i,JSON.stringify({objectId:e,object:t}))},g=e=>{o.send("/app/deleteObject",i,JSON.stringify({objectId:e}))};let s=w([]);const f=()=>{d&&(u.success("websocket重新连接成功..."),clearInterval(d),d=null),r=new M("/websocket"),o=U.over(r),o.connect(i,()=>{u.success("websocket连接成功..."),o.subscribe("/create",e=>{s.value.push(JSON.parse(e.body))}),o.subscribe("/delete",e=>{const t=JSON.parse(e.body).objectId;s.value=s.value.filter(n=>n.objectId!=t)}),o.subscribe("/update",e=>{const t=JSON.parse(e.body).objectId,n=s.value.findIndex(p=>p.objectId==t);s.value[n]=JSON.parse(e.body),j.value.insert(JSON.parse(e.body).object)})},e=>{d=setInterval(()=>{f()},5e3),u.error("websocket断线重连中...")}),z.post("/find",{className:l.TODO.name}).then(e=>{s.value=e.data.list})};x(()=>{f()}),D(()=>{o.disconnect(()=>{r.onclose,r.close(),u.success("websocket断开成功！")})});const k=()=>{const e=A.Object.extend(l.TODO.name),t=new e;t.set(l.TODO.keys.content,"Hello world!"),t.set(l.TODO.keys.done,!0),t.set(l.TODO.keys.user,F()());const n=JSON.stringify({object:t.attributes,className:t.className});o.send("/app/saveInBackground",i,n)};return(e,t)=>{const n=Q,p=N,S=I;return _(),m("div",R,[c("div",q,[P,$,(_(!0),m(E,null,J(V(s),a=>(_(),m("div",{key:a.objectId,class:"mdui-card",style:{margin:"10px 0",width:"500px"}},[c("div",H,[c("div",K,[O(L(a.object.user.username+"："),1),v(n,{modelValue:a.object.content,"onUpdate:modelValue":b=>a.object.content=b,clearable:"",onInput:b=>y(a.objectId,a.object)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),c("div",W,[v(p,{class:"relative top-1",onClick:b=>g(a.objectId)},null,8,["onClick"])])])]))),128)),v(S,{type:"primary",size:"default",onClick:k},{default:B(()=>[O("发送")]),_:1})])])}}}),ae=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{ae as _};
