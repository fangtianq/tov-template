/* empty css             */import{E as B}from"./tag-e591d4bb.js";import{E as ae}from"./button-6767a647.js";import{g as M,j as _,o as f,z as q,F as J,aq as H,c as D,ar as le,s as t,w as c,a9 as k,H as se,aa as L,K as ie,aw as ue,J as S,cz as C,b4 as s,cB as j,aD as ce,aH as re,r as p,A as n,O as de,cC as G,b5 as I,aK as me,aA as P}from"./index-c20bf65e.js";import{E as pe}from"./index-967dde3a.js";const fe=M({__name:"tags",props:{dynamicTags:{type:Array,default:()=>[]}},setup(R){const h=R,v=_(""),U=_(h.dynamicTags),F=_(!1),V=_(),z=r=>{U.value.splice(U.value.indexOf(r),1)},E=()=>{F.value=!0,se(()=>{V.value.input.focus()})},g=()=>{v.value&&U.value.push(v.value),F.value=!1,v.value=""};return(r,w)=>{const o=B,K=ae;return f(),q(J,null,[(f(!0),q(J,null,H(U.value,b=>(f(),D(o,{key:b,class:"mx-1",closable:"","disable-transitions":!1,onClose:d=>z(b)},{default:c(()=>[k(L(b),1)]),_:2},1032,["onClose"]))),128)),F.value?(f(),D(t(pe),{key:0,ref_key:"InputRef",ref:V,modelValue:v.value,"onUpdate:modelValue":w[0]||(w[0]=b=>v.value=b),class:"ml-1 w-20",size:"small",onKeyup:le(g,["enter"]),onBlur:g},null,8,["modelValue","onKeyup"])):(f(),D(K,{key:1,class:"button-new-tag ml-1",size:"small",onClick:E},{default:c(()=>[k(" + New Tag ")]),_:1}))],64)}}});const ge={class:"p-4 px-12"},xe=M({__name:"tgrjEdit1",setup(R){ie(()=>{T()});const h=ue(),v=_(),U=_(),F=_(),V=()=>{},z=a=>{o.content=a.content,o.contentTitle=g[a.type].content,o.dynamicTags.splice(0),o.dynamicTags.push(...a.tags),o.type=a.type,o.objectId=a.objectId,d.add=!0},E=async a=>{if(await G.modal.confirm("您确定要删除该数据?")==="confirm"){const u=F.value;I.Object.createWithoutData(s.FUCKDOG.name,a.objectId).destroy(),u.remove(a),G.modal.message({content:"删除成功。",status:"success"})}},g={fuckDog:{label:s.FUCKDOG.type.fuckDog,content:"甜狗日记"},sunnySaying:{label:s.FUCKDOG.type.sunnySaying,content:"阳光语录"},ikun:{label:s.FUCKDOG.type.ikun,content:"ikun（鸡你太美）"}},r=S({currentPage:1,pageSize:10,totalResult:300}),w=async a=>{const e=a.data,u=me.MD5(e.content).toString();if(!o.objectId){const m=C()(s.FUCKDOG.name);if(m.equalTo(s.FUCKDOG.keys.md5,u),(await m.find()).length!=0){G.modal.message({content:"当前语录已存在",status:"info"});return}}const y=I.Object.extend(s.FUCKDOG.name);let i=new y;o.objectId&&(i=I.Object.createWithoutData(s.FUCKDOG.name,o.objectId)),i.set(s.FUCKDOG.keys.type,e.type),i.set(s.FUCKDOG.keys.tags,o.dynamicTags),i.set(s.FUCKDOG.keys.content,e.content),i.set(s.FUCKDOG.keys.md5,u),i.addUnique(s.FUCKDOG.keys.like,P()().id),i.addUnique(s.FUCKDOG.keys.bookmark,P()().id),i.save().then(m=>{G.modal.message({content:"保存成功。",status:"success"}),v.value.close(),T()})},o=S({objectId:"",type:"fuckDog",dynamicTags:["fuckDog"],content:"",contentTitle:"舔狗日记"}),K=a=>{o.contentTitle=a.$radio.props.content,o.dynamicTags[0]=a.$radio.props.label},b=S({content:[{required:!0,message:"请输入..."},{min:1,max:5e3}]}),d=S({add:!1,filterName:"",tableData:[]}),T=()=>{const a=C()(s.FUCKDOG.name);a.count().then(y=>r.totalResult=y),a.contains("content",d.filterName);const e=C()(s.FUCKDOG.name);e.contains("type",d.filterName);const u=C()(s.FUCKDOG.name);u.contains("tags",d.filterName),j()().or(a,e,u).descending("updatedAt").limit(r.pageSize).skip((r.currentPage-1)*r.pageSize).find().then(y=>{d.tableData=y.map(i=>{const m=i.toJSON();return m.likeNum=m.like.length,m})})},W=ce.debounce(T,1e3),$=_(!0),A=re($),Q=()=>{const a=C()(s.FUCKDOG.name);a.equalTo(s.FUCKDOG.keys.like,P()().id),a.count().then(i=>r.totalResult=i),a.contains("content",d.filterName);const e=C()(s.FUCKDOG.name);e.contains("type",d.filterName);const u=C()(s.FUCKDOG.name);u.contains("tags",d.filterName);const y=j()().or(e,u);j()().and(a,y).descending("updatedAt").limit(r.pageSize).skip((r.currentPage-1)*r.pageSize).find().then(i=>{d.tableData=i.map(m=>{const O=m.toJSON();return O.likeNum=O.like.length,O})})};return(a,e)=>{const u=p("vxe-button"),y=p("vxe-input"),i=p("vxe-form-item"),m=p("vxe-radio"),O=fe,X=p("vxe-textarea"),Y=p("vxe-form"),Z=p("vxe-modal"),ee=p("vxe-toolbar"),x=p("vxe-column"),te=B,ne=p("vxe-table"),oe=p("vxe-pager");return f(),q("div",ge,[n(ee,null,{buttons:c(()=>[n(u,{icon:"vxe-icon-square-plus",onClick:e[0]||(e[0]=l=>t(d).add=!0)},{default:c(()=>[k("新增")]),_:1}),t($)?(f(),D(u,{key:0,icon:"vxe-icon-user-fill",onClick:e[1]||(e[1]=l=>(Q(),t(A)()))},{default:c(()=>[k("我的like")]),_:1})):(f(),D(u,{key:1,icon:"vxe-icon-user-fill",onClick:e[2]||(e[2]=l=>(T(),t(A)()))},{default:c(()=>[k("全部")]),_:1})),n(y,{modelValue:t(d).filterName,"onUpdate:modelValue":e[3]||(e[3]=l=>t(d).filterName=l),class:"pl-4",placeholder:"试试全表搜索",onKeyup:t(W)},null,8,["modelValue","onKeyup"]),n(Z,{ref_key:"xModal",ref:v,modelValue:t(d).add,"onUpdate:modelValue":e[8]||(e[8]=l=>t(d).add=l),title:"舔狗日记投稿",width:"1288",height:"888","show-zoom":"",resize:"","mask-closable":""},{default:c(()=>[n(Y,{ref_key:"xForm",ref:U,data:t(o),rules:t(b),"title-align":"right","title-width":"60",onSubmit:w,onReset:V},{default:c(()=>[n(i,{title:"欢迎各位舔狗分享自己的心酸历程","title-align":"left","title-width":"300px","title-prefix":{icon:"vxe-icon-question-circle-fill"}}),n(i,{title:"语录类型",field:"name",span:"24","title-colon":"","title-width":"100","item-render":{}},{default:c(()=>[n(m,{modelValue:t(o).type,"onUpdate:modelValue":e[4]||(e[4]=l=>t(o).type=l),label:g.fuckDog.label,content:g.fuckDog.content,onChange:K},null,8,["modelValue","label","content"]),n(m,{modelValue:t(o).type,"onUpdate:modelValue":e[5]||(e[5]=l=>t(o).type=l),label:g.sunnySaying.label,content:g.sunnySaying.content,onChange:K},null,8,["modelValue","label","content"]),n(m,{modelValue:t(o).type,"onUpdate:modelValue":e[6]||(e[6]=l=>t(o).type=l),label:g.ikun.label,content:g.ikun.content,onChange:K},null,8,["modelValue","label","content"])]),_:1}),n(i,{title:"标签",field:"tags",span:"24","title-colon":"","title-width":"100","item-render":{}},{default:c(()=>[n(O,{"dynamic-tags":t(o).dynamicTags},null,8,["dynamic-tags"])]),_:1}),n(i,{title:t(o).contentTitle,field:"content",span:"24","title-width":"100","title-colon":"","item-render":{}},{default:c(()=>[n(X,{modelValue:t(o).content,"onUpdate:modelValue":e[7]||(e[7]=l=>t(o).content=l),placeholder:"心路历程",rows:"24"},null,8,["modelValue"])]),_:1},8,["title"]),n(i,{align:"center",span:"24"},{default:c(()=>[n(u,{type:"submit",status:"primary"},{default:c(()=>[k("提交")]),_:1}),n(u,{type:"reset"},{default:c(()=>[k("重置")]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1},8,["modelValue"])]),_:1}),n(ne,{ref_key:"xTable",ref:F,data:t(d).tableData,stripe:"","row-config":{isCurrent:!0,isHover:!0}},{default:c(()=>[n(x,{type:"seq",title:"序号",width:"60"}),n(x,{field:"content",title:"内容","show-overflow":""}),n(x,{field:"type",title:"类型"}),n(x,{field:"tags",title:"标签"},{default:c(({row:l})=>[(f(!0),q(J,null,H(l.tags,N=>(f(),D(te,{key:N,class:"mx-1","disable-transitions":!1},{default:c(()=>[k(L(N),1)]),_:2},1024))),128))]),_:1}),n(x,{field:"like","show-overflow":"ellipsis",title:"like"}),n(x,{field:"likeNum",title:"likeNum"}),t(h)?(f(),D(x,{key:0,title:"操作",width:"100","show-overflow":""},{default:c(({row:l})=>[n(u,{type:"text",icon:"vxe-icon-edit",onClick:N=>z(l)},null,8,["onClick"]),n(u,{type:"text",icon:"vxe-icon-delete",onClick:N=>E(l)},null,8,["onClick"])]),_:1})):de("",!0)]),_:1},8,["data"]),n(oe,{"current-page":t(r).currentPage,"onUpdate:currentPage":e[9]||(e[9]=l=>t(r).currentPage=l),"page-size":t(r).pageSize,"onUpdate:pageSize":e[10]||(e[10]=l=>t(r).pageSize=l),background:"",total:t(r).totalResult,layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"],onPageChange:T},null,8,["current-page","page-size","total"])])}}});export{xe as _};
