import{d as $,ao as O,bX as W,o as V,as as G,b$ as R,A as X,a,b as o,t as d,aT as H,Z as m,p,c0 as w,F as c,P as k,v as K,c1 as q,b2 as z,ah as J,i as A,c2 as Z,h as l}from"./index.69fc3114.js";const Q={class:"p-8"},ee=o("div",{id:"m-loading"},[A(" \u9875\u9762\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85... "),o("h1",{style:{"white-space":"pre"}},[A(" \u63A8\u8350\u4E00\u4E2A m3u8 \u7F51\u9875\u7248\u63D0\u53D6\u5DE5\u5177\uFF0C\u65E0\u9700\u4E0B\u8F7D\u8F6F\u4EF6\uFF0C\u6253\u5F00\u7F51\u7AD9\u5373\u53EF\u4E0B\u8F7D\uFF0C\u81EA\u52A8\u68C0\u6D4B\uFF0C\u4E00\u952E\u4E0B\u8F7D\u3002 \u5DE5\u5177\u94FE\u63A5\uFF1Ahttps://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html \u5DE5\u5177\u6559\u7A0B\uFF1Ahttps://segmentfault.com/a/1190000021847172?_ea=32289224 "),o("img",{src:"https://upyun.luckly-mjw.cn/Assets/blog/m3u8-downloader-121-75.jpeg",alt:"m3u8 \u89C6\u9891\u4E0B\u8F7D\u5DE5\u5177",title:"logo"}),o("a",{target:"_blank",href:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html"},"\u70B9\u51FB\u8DF3\u8F6C")])],-1),ue={id:"m-app"},te={class:"m-p-action g-box"},ne=q('<a class="m-p-help" target="_blank" href="https://segmentfault.com/a/1190000021847172">?</a><a class="m-p-mse" target="_blank" href="https://segmentfault.com/a/1190000025182822">\u65E0\u5DEE\u522B\u63D0\u53D6\u5DE5\u5177</a><a class="m-p-tamper" target="_blank" href="https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/m3u8-downloader.user.js">\u624B\u52A8\u6DFB\u52A0/\u66F4\u65B0\u6CB9\u7334\u63D2\u4EF6</a><a class="m-p-github" target="_blank" href="https://github.com/Momo707577045/m3u8-downloader">github</a><a class="m-p-other" target="_blank" href="http://blog.luckly-mjw.cn/tool-show/index.html">\u5176\u4ED6\u5B9E\u7528\u5DE5\u5177</a><a class="m-p-language" href="http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index-en.html">English version</a>',6),se={key:0,class:"m-p-refer",target:"_blank",href:"https://segmentfault.com/a/1190000024416860"},oe=o("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/001.png",class:"link"},null,-1),ae=o("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/003.png",class:"text"},null,-1),le={class:"m-p-input-container"},ie=["disabled"],re=["disabled"],de=["disabled"],me={key:2,class:"disable"},Fe={key:3,class:"m-p-report",target:"_blank",href:"https://segmentfault.com/a/1190000021847172"},ce=o("a",{class:"m-p-final",target:"_blank",href:"https://segmentfault.com/a/1190000025182822"},"\u4E0B\u8F7D\u7684\u89C6\u9891\u770B\u4E0D\u4E86\uFF1F\u8BD5\u8BD5\u8FD9\u4E2A\u7EC8\u7ED3\u89E3\u51B3\u65B9\u6848\u300C\u65E0\u5DEE\u522B\u89C6\u9891\u63D0\u53D6\u5DE5\u5177\u300D\uFF0C\u6709\u914D\u5957\u300C\u6CB9\u7334\u300D\u63D2\u4EF6\u5566\uFF01\uFF01\uFF01",-1),ge=o("div",{class:"m-p-line"},null,-1),fe={class:"m-p-tips"},De={class:"m-p-segment"},he=["title","onClick"],we=$({__name:"xingyao",setup(Ee){const e=O({copyUrl:"http://1257120875.vod2.myqcloud.com/0ef121cdvodtransgzp1257120875/3055695e5285890780828799271/v.f230.m3u8",url:"",tips:"m3u8 \u89C6\u9891\u5728\u7EBF\u63D0\u53D6\u5DE5\u5177",title:"",isPause:!1,isGetMP4:!1,durationSecond:0,isShowRefer:!1,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],isSupperStreamWrite:!1,streamWriter:null,streamDownloadIndex:0,rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(u){return new TextEncoder().encode(u)}}}),{copy:b}=W(),v=()=>{b(e.copyUrl),z.success("\u590D\u5236\u6210\u529F")};V(()=>{var u;document.getElementById("m-loading")&&((u=document.getElementById("m-loading"))==null||u.remove()),x(),setInterval(S.bind(this),2e3)}),G(()=>{});const x=()=>{let{href:u}=location;u.indexOf("?source=")>-1&&(e.url.value=u.split("?source=")[1])},f=()=>{var t;let u=document.title;try{u=((t=window.top)==null?void 0:t.document.title)||""}catch{}return u},{enter:L}=R();X(L,u=>{u&&F()});const g=u=>{u=u||{};let t=new XMLHttpRequest;u.type==="file"&&(t.responseType="arraybuffer"),t.onreadystatechange=function(){if(t.readyState===4){let n=t.status;n>=200&&n<300?u.success&&u.success(t.response):u.fail&&u.fail(n)}},t.open("GET",u.url,!0),t.send(null)},B=(u,t)=>{if(t=t||location.href,u.indexOf("http")===0)return location.href.indexOf("https")===0?u.replace("http://","https://"):u;if(u[0]==="/"){let n=t.split("/");return n[0]+"//"+n[2]+u}else{let n=t.split("/");return n.pop(),n.join("/")+"/"+u}},C=u=>{e.isGetMP4=u,e.title=new URL(e.url).searchParams.get("title")||e.title;let t=e.title||h(new Date,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(t=f()),e.streamWriter=window.streamSaver.createWriteStream(`${t}.${u?"mp4":"ts"}`).getWriter(),F()},M=()=>{e.isGetMP4=!0,F()},F=(u=!1)=>{if(!e.url){alert("\u8BF7\u8F93\u5165\u94FE\u63A5");return}if(e.url.toLowerCase().indexOf("m3u8")===-1){alert("\u94FE\u63A5\u6709\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165");return}if(e.downloading){alert("\u8D44\u6E90\u4E0B\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E");return}if(location.href.indexOf("blog.luckly-mjw.cn")>-1&&e.url.indexOf(location.protocol)===-1){location.href=`${e.url.split(":")[0]}://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=${e.url}`;return}location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"",`${location.href.split("?")[0]}?source=${e.url}`),e.title=new URL(e.url).searchParams.get("title")||e.title,e.tips="m3u8 \u6587\u4EF6\u4E0B\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",e.beginTime=new Date,g({url:e.url,success:t=>{if(e.tsUrlList=[],e.finishList=[],t.split(`
`).forEach(n=>{/^[^#]/.test(n)&&(e.tsUrlList.push(B(n,e.url)),e.finishList.push({title:n,status:""}))}),u){e.rangeDownload.isShowRange=!0,e.rangeDownload.endSegment=e.tsUrlList.length,e.rangeDownload.targetSegment=e.tsUrlList.length;return}else{let n=Math.max(e.rangeDownload.startSegment||1,1),s=Math.max(e.rangeDownload.endSegment||e.tsUrlList.length,1);n=Math.min(n,e.tsUrlList.length),s=Math.min(s,e.tsUrlList.length),e.rangeDownload.startSegment=Math.min(n,s),e.rangeDownload.endSegment=Math.max(n,s),e.rangeDownload.targetSegment=e.rangeDownload.endSegment-e.rangeDownload.startSegment+1,e.downloadIndex=e.rangeDownload.startSegment-1,e.downloading=!0}if(e.isGetMP4){let n=0;t.split(`
`).forEach(s=>{s.toUpperCase().indexOf("#EXTINF:")>-1&&(n++,e.rangeDownload.startSegment<=n&&n<=e.rangeDownload.endSegment&&(e.durationSecond+=parseFloat(s.split("#EXTINF:")[1])))})}t.indexOf("#EXT-X-KEY")>-1?(e.aesConf.method=(t.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],e.aesConf.uri=(t.match(/(.*URI="([^"]+))"/)||["","",""])[2],e.aesConf.iv=(t.match(/(.*IV=([^,\s]+))/)||["","",""])[2],e.aesConf.iv=e.aesConf.iv?e.aesConf.stringToBuffer(e.aesConf.iv):"",e.aesConf.uri=B(e.aesConf.uri,e.url),I()):e.tsUrlList.length>0?D():E("\u8D44\u6E90\u4E3A\u7A7A\uFF0C\u8BF7\u67E5\u770B\u94FE\u63A5\u662F\u5426\u6709\u6548")},fail:()=>{E("\u94FE\u63A5\u4E0D\u6B63\u786E\uFF0C\u8BF7\u67E5\u770B\u94FE\u63A5\u662F\u5426\u6709\u6548")}})},I=()=>{g({type:"file",url:e.aesConf.uri,success:u=>{e.aesConf.key=e.aesConf.stringToBuffer(u),e.aesConf.key=u,e.aesConf.decryptor=J.AES,e.aesConf.decryptor.constructor(),e.aesConf.decryptor.expandKey(e.aesConf.key),D()},fail:()=>{E("\u89C6\u9891\u5DF2\u52A0\u5BC6\uFF0C\u53EF\u8BD5\u7528\u53F3\u4E0B\u89D2\u5165\u53E3\u7684\u300C\u65E0\u5DEE\u522B\u63D0\u53D6\u5DE5\u5177\u300D")}})},T=(u,t)=>{let n=u.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t]);return u.aesConf.decryptor.decrypt(u,0,n.buffer||n,!0)},D=()=>{e.tips="ts \u89C6\u9891\u788E\u7247\u4E0B\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E";let u=()=>{let t=e.isPause,n=e.downloadIndex;n>=e.rangeDownload.endSegment||(e.downloadIndex++,e.finishList[n]&&e.finishList[n].status===""?(e.finishList[n].status="downloading",g({url:e.tsUrlList[n],type:"file",success:s=>{y(s,n,()=>e.downloadIndex<e.rangeDownload.endSegment&&!t&&u())},fail:()=>{e.errorNum++,e.finishList[n].status="error",e.downloadIndex<e.rangeDownload.endSegment&&!t&&u()}})):e.downloadIndex<e.rangeDownload.endSegment&&!t&&u())};for(let t=0;t<Math.min(6,e.rangeDownload.targetSegment-e.finishNum);t++)u()},y=(u,t,n=()=>{})=>{const s=e.aesConf.uri?T(u,t):u;U(s,t,r=>{if(e.mediaFileList[t-e.rangeDownload.startSegment+1]=r,e.finishList[t].status="finish",e.finishNum++,e.streamWriter){for(let i=e.streamDownloadIndex;i<e.mediaFileList.length&&e.mediaFileList[i];i++)e.streamWriter.write(new Uint8Array(e.mediaFileList[i])),e.mediaFileList[i]=null,e.streamDownloadIndex=i+1;e.streamDownloadIndex>=e.rangeDownload.targetSegment&&e.streamWriter.close()}else if(e.finishNum===e.rangeDownload.targetSegment){let i=e.title||h(e.beginTime,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(i=f()),_(e.mediaFileList,i)}n&&n()})},U=(u,t,n)=>{if(u.isGetMP4){let s=new Z.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(u.durationSecond)});s.on("data",r=>{if(t===u.rangeDownload.startSegment-1){let i=new Uint8Array(r.initSegment.byteLength+r.data.byteLength);i.set(r.initSegment,0),i.set(r.data,r.initSegment.byteLength),n(i.buffer)}else n(r.data)}),s.push(new Uint8Array(u)),s.flush()}else n(u)},N=()=>{e.isPause=!e.isPause,!e.isPause&&e.retryAll(!0)},P=u=>{e.finishList[u].status==="error"&&(e.finishList[u].status="",g({url:e.tsUrlList[u],type:"file",success:t=>{e.errorNum--,y(t,u)},fail:()=>{e.finishList[u].status="error"}}))},S=u=>{if(!e.finishList.length||e.isPause)return;let t=e.downloadIndex;e.finishList.forEach((n,s)=>{n.status==="error"&&(n.status="",t=Math.min(t,s))}),e.errorNum=0,e.downloadIndex>=e.rangeDownload.endSegment||u?(e.downloadIndex=t,D()):e.downloadIndex=t},_=(u,t)=>{e.tips="ts \u788E\u7247\u6574\u5408\u4E2D\uFF0C\u8BF7\u7559\u610F\u6D4F\u89C8\u5668\u4E0B\u8F7D";let n=null,s=document.createElement("a");e.isGetMP4?(n=new Blob(u,{type:"video/mp4"}),s.download=t+".mp4"):(n=new Blob(u,{type:"video/MP2T"}),s.download=t+".ts"),s.href=URL.createObjectURL(n),s.style.display="none",document.body.appendChild(s),s.click(),s.remove()},h=(u,t)=>{const n={Y:u.getFullYear(),M:u.getMonth()+1,D:u.getDate(),h:u.getHours(),m:u.getMinutes(),s:u.getSeconds()};return t.replace(/Y+|M+|D+|h+|m+|s+/g,s=>(new Array(s.length).join("0")+n[s[0]]).substr(-s.length))},j=()=>{if(e.mediaFileList.length){let u=e.title||h(e.beginTime,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(u=f()),_(e.mediaFileList,u)}else alert("\u5F53\u524D\u65E0\u5DF2\u4E0B\u8F7D\u7247\u6BB5")},E=u=>{alert(u),e.downloading=!1,e.tips="m3u8 \u89C6\u9891\u5728\u7EBF\u63D0\u53D6\u5DE5\u5177"},Y=()=>{window.open("http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html")};return(u,t)=>(l(),a("div",Q,[ee,o("section",ue,[o("section",te,d(e.tips),1),ne,e.isShowRefer?(l(),a("a",se,[oe,ae,o("i",{class:"close",onClick:t[0]||(t[0]=H(n=>e.isShowRefer=!1,["prevent"]))})])):m("",!0),o("div",{class:"m-p-temp-url",onDblclick:v}," \u6D4B\u8BD5\u94FE\u63A5(\u53CC\u51FB\u590D\u5236)\uFF1A"+d(e.copyUrl),33),o("section",le,[p(o("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.url=n),type:"text",disabled:e.downloading,placeholder:"\u8BF7\u8F93\u5165 m3u8 \u94FE\u63A5"},null,8,ie),[[w,e.url]]),!e.downloading||e.rangeDownload.isShowRange?(l(),a(c,{key:0},[e.rangeDownload.isShowRange?(l(),a(c,{key:1},[p(o("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>e.rangeDownload.startSegment=n),class:"range-input",type:"number",disabled:e.downloading,placeholder:"\u8D77\u59CB\u7247\u6BB5"},null,8,re),[[w,e.rangeDownload.startSegment]]),p(o("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>e.rangeDownload.endSegment=n),class:"range-input",type:"number",disabled:e.downloading,placeholder:"\u622A\u6B62\u7247\u6BB5"},null,8,de),[[w,e.rangeDownload.endSegment]])],64)):(l(),a("div",{key:0,onClick:t[2]||(t[2]=n=>F(!0))}," \u7279\u5B9A\u8303\u56F4\u4E0B\u8F7D "))],64)):m("",!0),e.downloading?e.finishNum===e.rangeDownload.targetSegment&&e.rangeDownload.targetSegment>0?(l(),a("div",me," \u4E0B\u8F7D\u5B8C\u6210 ")):(l(),a("div",{key:3,onClick:N},d(e.isPause?"\u6062\u590D\u4E0B\u8F7D":"\u6682\u505C\u4E0B\u8F7D"),1)):(l(),a(c,{key:1},[o("div",{onClick:t[5]||(t[5]=n=>F(!1))},"\u539F\u683C\u5F0F\u4E0B\u8F7D"),o("div",{onClick:M},"\u8F6C\u7801\u4E3AMP4\u4E0B\u8F7D")],64))]),!e.downloading&&e.isSupperStreamWrite?(l(),a("div",{key:1,class:"m-p-stream",onClick:t[6]||(t[6]=n=>C(!1))}," \u7279\u5927\u89C6\u9891\u539F\u683C\u5F0F\u4E0B\u8F7D\uFF0C\u8FB9\u4E0B\u8F7D\u8FB9\u4FDD\u5B58\uFF0C\u5F7B\u5E95\u89E3\u51B3\u5927\u6587\u4EF6\u4E0B\u8F7D\u5185\u5B58\u4E0D\u8DB3\u95EE\u9898 ")):m("",!0),!e.downloading&&e.isSupperStreamWrite?(l(),a("div",{key:2,class:"m-p-stream",onClick:t[7]||(t[7]=n=>C(!0))}," \u7279\u5927\u89C6\u9891 MP4 \u683C\u5F0F\u4E0B\u8F7D\uFF0C\u8FB9\u4E0B\u8F7D\u8FB9\u4FDD\u5B58\uFF0C\u5F7B\u5E95\u89E3\u51B3\u5927\u6587\u4EF6\u4E0B\u8F7D\u5185\u5B58\u4E0D\u8DB3\u95EE\u9898 ")):m("",!0),e.downloading?m("",!0):(l(),a("a",Fe,"\u8FD0\u884C\u51FA\u73B0\u95EE\u9898\uFF0C\u53EF\u70B9\u51FB\u6B64\u6309\u94AE\u7559\u8A00\u53CD\u9988\uFF0C\u4F5C\u8005\u5C06\u7B2C\u4E00\u65F6\u95F4\u8DDF\u8FDB\uFF0C\u5171\u540C\u7EF4\u62A4\u672C\u9879\u76EE")),o("div",{class:"m-p-cross",onClick:Y}," \u5F53\u65E0\u6CD5\u4E0B\u8F7D\uFF0C\u70B9\u51FB\u8DF3\u8F6C\u5230\u539F\u9875\u9762\u67E5\u770B\u89E3\u51B3\u529E\u6CD5 "),ce,e.finishList.length>0?(l(),a(c,{key:4},[ge,e.errorNum&&e.downloadIndex>=e.rangeDownload.targetSegment?(l(),a("div",{key:0,class:"m-p-retry",onClick:S}," \u91CD\u65B0\u4E0B\u8F7D\u9519\u8BEF\u7247\u6BB5 ")):m("",!0),e.mediaFileList.length&&!e.streamWriter?(l(),a("div",{key:1,class:"m-p-force",onClick:j}," \u5F3A\u5236\u4E0B\u8F7D\u73B0\u6709\u7247\u6BB5 ")):m("",!0),o("div",fe," \u5F85\u4E0B\u8F7D\u788E\u7247\u603B\u91CF\uFF1A"+d(e.rangeDownload.targetSegment)+"\uFF0C\u5DF2\u4E0B\u8F7D\uFF1A"+d(e.finishNum)+"\uFF0C\u9519\u8BEF\uFF1A"+d(e.errorNum)+"\uFF0C\u8FDB\u5EA6\uFF1A"+d((e.finishNum/e.rangeDownload.targetSegment*100).toFixed(2))+"% ",1),o("div",{class:k(["m-p-tips",[e.errorNum?"error-tips":""]])}," \u82E5\u67D0\u89C6\u9891\u788E\u7247\u4E0B\u8F7D\u53D1\u751F\u9519\u8BEF\uFF0C\u5C06\u6807\u8BB0\u4E3A\u7EA2\u8272\uFF0C\u53EF\u70B9\u51FB\u76F8\u5E94\u56FE\u6807\u8FDB\u884C\u91CD\u8BD5 ",2),o("section",De,[(l(!0),a(c,null,K(e.finishList,(n,s)=>(l(),a("div",{key:n,class:k(["item",[n.status]]),title:n.title,onClick:r=>P(s)},d(s+1),11,he))),128))])],64)):m("",!0)])]))}});export{we as default};
