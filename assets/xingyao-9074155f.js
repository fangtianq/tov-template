import{d as W,ao as B,bY as A,o as V,ar as G,b$ as R,z as X,ah as q,a as l,b as i,e as a,t as m,aW as z,Z as u,q as S,c0 as _,F as g,P as C,s as H,j as L,c1 as K,aP as J,c2 as Z}from"./index-1227f530.js";const Q={class:"p-8"},ee=a("div",{id:"m-loading"},[L(" 页面加载中，请耐心等待... "),a("h1",{style:{"white-space":"pre"}},[L(" 推荐一个 m3u8 网页版提取工具，无需下载软件，打开网站即可下载，自动检测，一键下载。 工具链接：https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html 工具教程：https://segmentfault.com/a/1190000021847172?_ea=32289224 "),a("img",{src:"https://upyun.luckly-mjw.cn/Assets/blog/m3u8-downloader-121-75.jpeg",alt:"m3u8 视频下载工具",title:"logo"}),a("a",{target:"_blank",href:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html"},"点击跳转")])],-1),te={id:"m-app"},ne={class:"m-p-action g-box"},se=K('<a class="m-p-help" target="_blank" href="https://segmentfault.com/a/1190000021847172">?</a><a class="m-p-mse" target="_blank" href="https://segmentfault.com/a/1190000025182822">无差别提取工具</a><a class="m-p-tamper" target="_blank" href="https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/m3u8-downloader.user.js">手动添加/更新油猴插件</a><a class="m-p-github" target="_blank" href="https://github.com/Momo707577045/m3u8-downloader">github</a><a class="m-p-other" target="_blank" href="http://blog.luckly-mjw.cn/tool-show/index.html">其他实用工具</a><a class="m-p-language" href="http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index-en.html">English version</a>',6),oe={key:0,class:"m-p-refer",target:"_blank",href:"https://segmentfault.com/a/1190000024416860"},ae=a("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/001.png",class:"link"},null,-1),le=a("img",{src:"https://blog.luckly-mjw.cn/tool-show/m3u8-downloader/imgs/003.png",class:"text"},null,-1),ie={class:"m-p-input-container"},re=["disabled"],de=["disabled"],me=["disabled"],ue={key:2,class:"disable"},ce={key:3,class:"m-p-report",target:"_blank",href:"https://segmentfault.com/a/1190000021847172"},ge=a("a",{class:"m-p-final",target:"_blank",href:"https://segmentfault.com/a/1190000025182822"},"下载的视频看不了？试试这个终结解决方案「无差别视频提取工具」，有配套「油猴」插件啦！！！",-1),fe=a("div",{class:"m-p-line"},null,-1),he={class:"m-p-tips"},pe={class:"m-p-segment"},we=["title","onClick"],_e=W({__name:"xingyao",setup(ye){const e=B({copyUrl:"http://1257120875.vod2.myqcloud.com/0ef121cdvodtransgzp1257120875/3055695e5285890780828799271/v.f230.m3u8",url:"",tips:"m3u8 视频在线提取工具",title:"",isPause:!1,isGetMP4:!1,durationSecond:0,isShowRefer:!1,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],isSupperStreamWrite:!1,streamWriter:null,streamDownloadIndex:0,rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(t){return new TextEncoder().encode(t)}}}),{copy:M}=A(),I=()=>{M(e.copyUrl),J.success("复制成功")};V(()=>{var t;document.getElementById("m-loading")&&((t=document.getElementById("m-loading"))==null||t.remove()),T(),setInterval(v.bind(this),2e3)}),G(()=>{});const T=()=>{let{href:t}=location;t.indexOf("?source=")>-1&&(e.url.value=t.split("?source=")[1])},h=()=>{var n;let t=document.title;try{t=((n=window.top)==null?void 0:n.document.title)||""}catch{}return t},{enter:P}=R();X(P,t=>{t&&c()});const f=t=>{t=t||{};let n=new XMLHttpRequest;t.type==="file"&&(n.responseType="arraybuffer"),n.onreadystatechange=function(){if(n.readyState===4){let s=n.status;s>=200&&s<300?t.success&&t.success(n.response):t.fail&&t.fail(s)}},n.open("GET",t.url,!0),n.send(null)},D=(t,n)=>{if(n=n||location.href,t.indexOf("http")===0)return location.href.indexOf("https")===0?t.replace("http://","https://"):t;if(t[0]==="/"){let s=n.split("/");return s[0]+"//"+s[2]+t}else{let s=n.split("/");return s.pop(),s.join("/")+"/"+t}},k=t=>{e.isGetMP4=t,e.title=new URL(e.url).searchParams.get("title")||e.title;let n=e.title||w(new Date,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(n=h()),e.streamWriter=window.streamSaver.createWriteStream(`${n}.${t?"mp4":"ts"}`).getWriter(),c()},U=()=>{e.isGetMP4=!0,c()},c=(t=!1)=>{if(!e.url){alert("请输入链接");return}if(e.url.toLowerCase().indexOf("m3u8")===-1){alert("链接有误，请重新输入");return}if(e.downloading){alert("资源下载中，请稍后");return}if(location.href.indexOf("blog.luckly-mjw.cn")>-1&&e.url.indexOf(location.protocol)===-1){location.href=`${e.url.split(":")[0]}://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=${e.url}`;return}location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"",`${location.href.split("?")[0]}?source=${e.url}`),e.title=new URL(e.url).searchParams.get("title")||e.title,e.tips="m3u8 文件下载中，请稍后",e.beginTime=new Date,f({url:e.url,success:n=>{if(e.tsUrlList=[],e.finishList=[],n.split(`
`).forEach(s=>{/^[^#]/.test(s)&&(e.tsUrlList.push(D(s,e.url)),e.finishList.push({title:s,status:""}))}),t){e.rangeDownload.isShowRange=!0,e.rangeDownload.endSegment=e.tsUrlList.length,e.rangeDownload.targetSegment=e.tsUrlList.length;return}else{let s=Math.max(e.rangeDownload.startSegment||1,1),o=Math.max(e.rangeDownload.endSegment||e.tsUrlList.length,1);s=Math.min(s,e.tsUrlList.length),o=Math.min(o,e.tsUrlList.length),e.rangeDownload.startSegment=Math.min(s,o),e.rangeDownload.endSegment=Math.max(s,o),e.rangeDownload.targetSegment=e.rangeDownload.endSegment-e.rangeDownload.startSegment+1,e.downloadIndex=e.rangeDownload.startSegment-1,e.downloading=!0}if(e.isGetMP4){let s=0;n.split(`
`).forEach(o=>{o.toUpperCase().indexOf("#EXTINF:")>-1&&(s++,e.rangeDownload.startSegment<=s&&s<=e.rangeDownload.endSegment&&(e.durationSecond+=parseFloat(o.split("#EXTINF:")[1])))})}n.indexOf("#EXT-X-KEY")>-1?(e.aesConf.method=(n.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],e.aesConf.uri=(n.match(/(.*URI="([^"]+))"/)||["","",""])[2],e.aesConf.iv=(n.match(/(.*IV=([^,\s]+))/)||["","",""])[2],e.aesConf.iv=e.aesConf.iv?e.aesConf.stringToBuffer(e.aesConf.iv):"",e.aesConf.uri=D(e.aesConf.uri,e.url),N()):e.tsUrlList.length>0?p():y("资源为空，请查看链接是否有效")},fail:()=>{y("链接不正确，请查看链接是否有效")}})},N=()=>{f({type:"file",url:e.aesConf.uri,success:t=>{e.aesConf.key=e.aesConf.stringToBuffer(t),e.aesConf.key=t,e.aesConf.decryptor=q.AES,e.aesConf.decryptor.constructor(),e.aesConf.decryptor.expandKey(e.aesConf.key),p()},fail:()=>{y("视频已加密，可试用右下角入口的「无差别提取工具」")}})},j=(t,n)=>{let s=t.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n]);return t.aesConf.decryptor.decrypt(t,0,s.buffer||s,!0)},p=()=>{e.tips="ts 视频碎片下载中，请稍后";let t=()=>{let n=e.isPause,s=e.downloadIndex;s>=e.rangeDownload.endSegment||(e.downloadIndex++,e.finishList[s]&&e.finishList[s].status===""?(e.finishList[s].status="downloading",f({url:e.tsUrlList[s],type:"file",success:o=>{b(o,s,()=>e.downloadIndex<e.rangeDownload.endSegment&&!n&&t())},fail:()=>{e.errorNum++,e.finishList[s].status="error",e.downloadIndex<e.rangeDownload.endSegment&&!n&&t()}})):e.downloadIndex<e.rangeDownload.endSegment&&!n&&t())};for(let n=0;n<Math.min(6,e.rangeDownload.targetSegment-e.finishNum);n++)t()},b=(t,n,s=()=>{})=>{const o=e.aesConf.uri?j(t,n):t;E(o,n,d=>{if(e.mediaFileList[n-e.rangeDownload.startSegment+1]=d,e.finishList[n].status="finish",e.finishNum++,e.streamWriter){for(let r=e.streamDownloadIndex;r<e.mediaFileList.length&&e.mediaFileList[r];r++)e.streamWriter.write(new Uint8Array(e.mediaFileList[r])),e.mediaFileList[r]=null,e.streamDownloadIndex=r+1;e.streamDownloadIndex>=e.rangeDownload.targetSegment&&e.streamWriter.close()}else if(e.finishNum===e.rangeDownload.targetSegment){let r=e.title||w(e.beginTime,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(r=h()),x(e.mediaFileList,r)}s&&s()})},E=(t,n,s)=>{if(t.isGetMP4){let o=new Z.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(t.durationSecond)});o.on("data",d=>{if(n===t.rangeDownload.startSegment-1){let r=new Uint8Array(d.initSegment.byteLength+d.data.byteLength);r.set(d.initSegment,0),r.set(d.data,d.initSegment.byteLength),s(r.buffer)}else s(d.data)}),o.push(new Uint8Array(t)),o.flush()}else s(t)},F=()=>{e.isPause=!e.isPause,!e.isPause&&e.retryAll(!0)},Y=t=>{e.finishList[t].status==="error"&&(e.finishList[t].status="",f({url:e.tsUrlList[t],type:"file",success:n=>{e.errorNum--,b(n,t)},fail:()=>{e.finishList[t].status="error"}}))},v=t=>{if(!e.finishList.length||e.isPause)return;let n=e.downloadIndex;e.finishList.forEach((s,o)=>{s.status==="error"&&(s.status="",n=Math.min(n,o))}),e.errorNum=0,e.downloadIndex>=e.rangeDownload.endSegment||t?(e.downloadIndex=n,p()):e.downloadIndex=n},x=(t,n)=>{e.tips="ts 碎片整合中，请留意浏览器下载";let s=null,o=document.createElement("a");e.isGetMP4?(s=new Blob(t,{type:"video/mp4"}),o.download=n+".mp4"):(s=new Blob(t,{type:"video/MP2T"}),o.download=n+".ts"),o.href=URL.createObjectURL(s),o.style.display="none",document.body.appendChild(o),o.click(),o.remove()},w=(t,n)=>{const s={Y:t.getFullYear(),M:t.getMonth()+1,D:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()};return n.replace(/Y+|M+|D+|h+|m+|s+/g,o=>(new Array(o.length).join("0")+s[o[0]]).substr(-o.length))},$=()=>{if(e.mediaFileList.length){let t=e.title||w(e.beginTime,"YYYY_MM_DD hh_mm_ss");document.title!=="m3u8 downloader"&&(t=h()),x(e.mediaFileList,t)}else alert("当前无已下载片段")},y=t=>{alert(t),e.downloading=!1,e.tips="m3u8 视频在线提取工具"},O=()=>{window.open("http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html")};return(t,n)=>(l(),i("div",Q,[ee,a("section",te,[a("section",ne,m(e.tips),1),se,e.isShowRefer?(l(),i("a",oe,[ae,le,a("i",{class:"close",onClick:n[0]||(n[0]=z(s=>e.isShowRefer=!1,["prevent"]))})])):u("",!0),a("div",{class:"m-p-temp-url",onDblclick:I}," 测试链接(双击复制)："+m(e.copyUrl),33),a("section",ie,[S(a("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>e.url=s),type:"text",disabled:e.downloading,placeholder:"请输入 m3u8 链接"},null,8,re),[[_,e.url]]),!e.downloading||e.rangeDownload.isShowRange?(l(),i(g,{key:0},[e.rangeDownload.isShowRange?(l(),i(g,{key:1},[S(a("input",{"onUpdate:modelValue":n[3]||(n[3]=s=>e.rangeDownload.startSegment=s),class:"range-input",type:"number",disabled:e.downloading,placeholder:"起始片段"},null,8,de),[[_,e.rangeDownload.startSegment]]),S(a("input",{"onUpdate:modelValue":n[4]||(n[4]=s=>e.rangeDownload.endSegment=s),class:"range-input",type:"number",disabled:e.downloading,placeholder:"截止片段"},null,8,me),[[_,e.rangeDownload.endSegment]])],64)):(l(),i("div",{key:0,onClick:n[2]||(n[2]=s=>c(!0))}," 特定范围下载 "))],64)):u("",!0),e.downloading?e.finishNum===e.rangeDownload.targetSegment&&e.rangeDownload.targetSegment>0?(l(),i("div",ue," 下载完成 ")):(l(),i("div",{key:3,onClick:F},m(e.isPause?"恢复下载":"暂停下载"),1)):(l(),i(g,{key:1},[a("div",{onClick:n[5]||(n[5]=s=>c(!1))},"原格式下载"),a("div",{onClick:U},"转码为MP4下载")],64))]),!e.downloading&&e.isSupperStreamWrite?(l(),i("div",{key:1,class:"m-p-stream",onClick:n[6]||(n[6]=s=>k(!1))}," 特大视频原格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):u("",!0),!e.downloading&&e.isSupperStreamWrite?(l(),i("div",{key:2,class:"m-p-stream",onClick:n[7]||(n[7]=s=>k(!0))}," 特大视频 MP4 格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")):u("",!0),e.downloading?u("",!0):(l(),i("a",ce,"运行出现问题，可点击此按钮留言反馈，作者将第一时间跟进，共同维护本项目")),a("div",{class:"m-p-cross",onClick:O}," 当无法下载，点击跳转到原页面查看解决办法 "),ge,e.finishList.length>0?(l(),i(g,{key:4},[fe,e.errorNum&&e.downloadIndex>=e.rangeDownload.targetSegment?(l(),i("div",{key:0,class:"m-p-retry",onClick:v}," 重新下载错误片段 ")):u("",!0),e.mediaFileList.length&&!e.streamWriter?(l(),i("div",{key:1,class:"m-p-force",onClick:$}," 强制下载现有片段 ")):u("",!0),a("div",he," 待下载碎片总量："+m(e.rangeDownload.targetSegment)+"，已下载："+m(e.finishNum)+"，错误："+m(e.errorNum)+"，进度："+m((e.finishNum/e.rangeDownload.targetSegment*100).toFixed(2))+"% ",1),a("div",{class:C(["m-p-tips",[e.errorNum?"error-tips":""]])}," 若某视频碎片下载发生错误，将标记为红色，可点击相应图标进行重试 ",2),a("section",pe,[(l(!0),i(g,null,H(e.finishList,(s,o)=>(l(),i("div",{key:s,class:C(["item",[s.status]]),title:s.title,onClick:d=>Y(o)},m(o+1),11,we))),128))])],64)):u("",!0)])]))}});export{_e as default};
